#!/bin/bash
# $Id: runtests,v 1.6 2016/04/13 02:09:30 bediger Exp $

rm -rf output
mkdir output

for TNAME in zoo/*.php
do
	echo test $TNAME
	B=$(basename ${TNAME%.*})
	OUTPUT=output/$B.out
	DESIRED=desired/$B.out
	./revphp $TNAME > $OUTPUT
	if diff -q $OUTPUT $DESIRED
	then
		:
	else
		echo Problem with test $TNAME
		echo "# diff {output,desired}/$B.out"
		#exit 1
	fi
done

echo Complicated test t1.php
./revphp -D tests/zork.php tests/t1.php > output/t1.out
if diff -q output/t1.out desired/t1.out
then
	:
else
	echo Problem with complicated test t1.php
	echo "# diff {output,desired}/t1.out"
fi
echo Complicated test t1_1.php
./revphp -r zork -D tests/zork.php tests/t1_1.php > output/t1_1.out
if diff -q output/t1_1.out desired/t1_1.out
then
	:
else
	echo Problem with complicated test t1_1.php
	echo "# diff {output,desired}/t1_1.out"
fi
echo Complicated test f3x.php
./revphp  -f l__3 -f l__14 -f l__15 -f l__18 -r _1825599023 -D tests/f3xdecode.php tests/f3x.php > output/f3x.out
if diff -q output/f3x.out desired/f3x.out
then
	:
else
	echo Problem with complicated test f3x.php
	echo "# diff {output,desired}/f3x.out"
fi
echo Complicated test concat.php
./revphp  -D tests/zork.php tests/concat.php > output/concat.out
if diff -q output/concat.out desired/concat.out
then
	:
else
	echo Problem with complicated test concat.php
	echo "# diff {output,desired}/concat.out"
fi
